{"version":3,"file":"profile.js","sourceRoot":"","sources":["../../src/modals/profile.ts"],"names":[],"mappings":"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","sourcesContent":["import { createJazzicon, logout, tokenManager } from \"@gaiaprotocol/client-common\";\nimport { el } from \"@webtaku/el\";\nimport Navigo from \"navigo\";\nimport { getAddress, zeroAddress } from \"viem\";\nimport { profileService } from \"../services/profile\";\nimport { shortenAddress } from \"../utils/address\";\nimport { createProfileFormModal } from \"./profile-form\";\n\nfunction createProfileModal(router: Navigo): HTMLElement {\n  const _addr = tokenManager.getAddress();\n  const myAddress = _addr ? getAddress(_addr) : zeroAddress;\n  const token = tokenManager.getToken() || '';\n\n  const avatar = createJazzicon(myAddress);\n  avatar.style.width = '64px';\n  avatar.style.height = '64px';\n  avatar.style.margin = 'auto';\n\n  const nicknameSpan = el(\"span\", \"\", { style: \"font-weight: bold; font-size: 1.1em;\" });\n  const addressSpan = el(\"span\", shortenAddress(myAddress), { style: \"color: gray;\" });\n  const bioSpan = el(\"span\", \"\", { style: \"font-size: 0.9em; color: #666;\" });\n\n  const modal = el('ion-modal', { trigger: 'open-profile' });\n\n  const profileCard = el('ion-card',\n    el('ion-card-header', {\n      style: `\n      text-align: center;\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n    `},\n      el('ion-avatar', { style: 'width:64px;height:64px;margin:auto' }, avatar),\n      nicknameSpan,\n      addressSpan,\n      bioSpan\n    )\n  );\n\n  // 최초 로드 시 캐시에서 불러옴\n  const updateProfileDisplay = () => {\n    const cached = profileService.getCached(myAddress);\n    if (cached) {\n      nicknameSpan.textContent = cached.nickname || shortenAddress(myAddress);\n      bioSpan.textContent = cached.bio ?? '';\n    } else {\n      nicknameSpan.textContent = shortenAddress(myAddress);\n      bioSpan.textContent = '';\n    }\n  };\n\n  updateProfileDisplay();\n\n  profileService.resolve(myAddress).then(() => {\n    updateProfileDisplay();\n  });\n\n  // 내 프로필 변경되면 갱신\n  profileService.addEventListener('myprofilechange', () => {\n    updateProfileDisplay();\n  });\n\n  const menuItem = (icon: string, title: string, subtitle = '', onClick?: () => void) =>\n    el('ion-item', { button: !!onClick, onclick: onClick },\n      el('ion-icon', { name: icon, slot: 'start' }),\n      el('ion-label', el('h2', title), subtitle ? el('p', subtitle) : undefined)\n    );\n\n  const modalContent = el('ion-content.ion-padding',\n    profileCard,\n\n    el('ion-list',\n      menuItem('person-circle', '프로필 편집', '닉네임과 자기소개를 수정합니다.', () => {\n        const formModal = createProfileFormModal(myAddress, token);\n        document.body.appendChild(formModal);\n        formModal.present();\n      }),\n\n      menuItem('log-out', '로그아웃', '', async () => {\n        await logout();\n        router.navigate('/login');\n      }),\n    )\n  );\n\n  const modalHeader = el('ion-header',\n    el('ion-toolbar',\n      el('ion-title', '프로필'),\n      el('ion-buttons', { slot: 'end' },\n        el('ion-button', { onclick: () => modal.dismiss() }, '닫기')\n      ),\n    )\n  );\n\n  modal.append(modalHeader, modalContent);\n  return modal;\n}\n\nexport { createProfileModal };\n"]}