{"version":3,"file":"google-login.js","sourceRoot":"","sources":["../../src/auth/google-login.ts"],"names":[],"mappings":"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","sourcesContent":["import { logoutGoogle, verifyGoogleLogin } from \"../api/google\";\nimport { isWebView, platform } from \"../platform\";\n\ndeclare const API_BASE_URI: string;\n\nconst GOOGLE_LOGIN_PATH = `${API_BASE_URI}/google-login`;\n\nexport function googleLogin() {\n  if (isWebView && (window as any).Native?.signInWithGoogle) {\n    (window as any).Native.signInWithGoogle()\n  } else if (isWebView && (window as any).Android?.signInWithGoogle) {\n    (window as any).Android.signInWithGoogle()\n  } else {\n    location.href = GOOGLE_LOGIN_PATH\n  }\n}\n\nlet signOutResolve: (() => void) | undefined;\nexport async function googleLogout() {\n  if (isWebView && (window as any).Native?.signOutFromGoogle) {\n    (window as any).Native.signOutFromGoogle()\n    return new Promise<void>(resolve => signOutResolve = resolve)\n  } else if (isWebView && (window as any).Android?.signOutFromGoogle) {\n    (window as any).Android.signOutFromGoogle()\n    return new Promise<void>(resolve => signOutResolve = resolve)\n  } else {\n    await logoutGoogle()\n  }\n}\n\nif (isWebView) {\n  window.addEventListener('googleSignInComplete', async (e: any) => {\n    const { idToken, nonce } = e.detail\n    try {\n      // 서버에서 구글 공개키로 ID 토큰 검증 + nonce 검증 + aud(=WEB_CLIENT_ID) 검증 필수\n      const { ok } = await verifyGoogleLogin({ provider: 'google', idToken, nonce })\n      if (ok) location.href = `/?platform=${platform}&source=webview`;\n      else {\n        const toast = document.createElement(\"ion-toast\");\n        toast.message = `Google sign-in failed. ${e.detail.message}`;\n        toast.duration = 1600;\n        toast.position = \"bottom\";\n        document.body.appendChild(toast);\n        (toast as any).present();\n      }\n    } catch (error: any) {\n      const toast = document.createElement(\"ion-toast\");\n      toast.message = `Google sign-in failed. ${error.message}`;\n      toast.duration = 1600;\n      toast.position = \"bottom\";\n      document.body.appendChild(toast);\n      (toast as any).present();\n    }\n  })\n\n  window.addEventListener('googleSignInFailed', (e: any) => {\n    console.warn('Google sign-in failed', e.detail)\n\n    const toast = document.createElement(\"ion-toast\");\n    toast.message = `Google sign-in failed. ${e.detail.message}`;\n    toast.duration = 1600;\n    toast.position = \"bottom\";\n    document.body.appendChild(toast);\n    (toast as any).present();\n  })\n\n  window.addEventListener('googleSignOutComplete', () => {\n    signOutResolve?.()\n  });\n\n  window.addEventListener('googleSignOutFailed', (e: any) => {\n    console.error('Sign-out failed:', e.detail?.message);\n\n    const toast = document.createElement(\"ion-toast\");\n    toast.message = `Google sign-out failed. ${e.detail.message}`;\n    toast.duration = 1600;\n    toast.position = \"bottom\";\n    document.body.appendChild(toast);\n    (toast as any).present();\n  });\n}\n"]}