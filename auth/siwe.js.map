{"version":3,"file":"siwe.js","sourceRoot":"","sources":["../../src/auth/siwe.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAC1D,OAAO,EAAE,WAAW,IAAI,gBAAgB,EAAE,MAAM,aAAa,CAAC;AAC9D,OAAO,EAAE,iBAAiB,IAAI,qBAAqB,EAAE,MAAM,WAAW,CAAC;AACvE,OAAO,EAAE,wBAAwB,EAAE,MAAM,SAAS,CAAC;AAInD,SAAS,iBAAiB,CAAC,OAAsB,EAAE,KAAa,EAAE,QAAgB;IAEhF,OAAO,CAAC,GAAG,CAAC;QACV,MAAM,EAAE,QAAQ,CAAC,IAAI;QACrB,OAAO;QACP,SAAS,EAAE,wBAAwB;QACnC,GAAG,EAAE,QAAQ,CAAC,MAAM;QACpB,OAAO,EAAE,GAAG;QACZ,OAAO,EAAE,IAAI;QACb,KAAK;QACL,QAAQ,EAAE,IAAI,IAAI,CAAC,QAAQ,CAAC;KAC7B,CAAC,CAAC;IAEH,OAAO,qBAAqB,CAAC;QAC3B,MAAM,EAAE,QAAQ,CAAC,IAAI;QACrB,OAAO;QACP,SAAS,EAAE,wBAAwB;QACnC,GAAG,EAAE,QAAQ,CAAC,MAAM;QACpB,OAAO,EAAE,GAAG;QACZ,OAAO,EAAE,IAAI;QACb,KAAK;QACL,QAAQ,EAAE,IAAI,IAAI,CAAC,QAAQ,CAAC;KAC7B,CAAC,CAAC;AACL,CAAC;AAED,KAAK,UAAU,WAAW,CAAC,OAAsB;IAC/C,MAAM,QAAQ,GAAG,MAAM,KAAK,CAC1B,GAAG,YAAY,QAAQ,EACvB;QACE,MAAM,EAAE,MAAM;QACd,OAAO,EAAE,EAAE,cAAc,EAAE,kBAAkB,EAAE;QAC/C,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;YACnB,OAAO;YACP,MAAM,EAAE,QAAQ,CAAC,IAAI;YACrB,GAAG,EAAE,QAAQ,CAAC,MAAM;SACrB,CAAC;KACH,CACF,CAAC;IACF,IAAI,CAAC,QAAQ,CAAC,EAAE;QAAE,MAAM,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC;IACtD,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;IAClD,IAAI,CAAC,KAAK,IAAI,CAAC,QAAQ;QAAE,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;IAEhE,MAAM,WAAW,GAAG,iBAAiB,CAAC,OAAO,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;IAEhE,OAAO,MAAM,gBAAgB,CAAC,WAAW,EAAE;QACzC,OAAO,EAAE,WAAW;QACpB,OAAO,EAAE,OAAO;KACjB,CAAC,CAAC;AACL,CAAC;AAED,OAAO,EAAE,WAAW,EAAE,CAAC","sourcesContent":["import { wagmiConfig } from '@gaiaprotocol/client-common';\nimport { signMessage as wagmiSignMessage } from '@wagmi/core';\nimport { createSiweMessage as viemCreateSiweMessage } from 'viem/siwe';\nimport { MESSAGE_FOR_WALLET_LOGIN } from '../vars';\n\ndeclare const API_BASE_URI: string;\n\nfunction createSiweMessage(address: `0x${string}`, nonce: string, issuedAt: string) {\n\n  console.log({\n    domain: location.host,\n    address,\n    statement: MESSAGE_FOR_WALLET_LOGIN,\n    uri: location.origin,\n    version: '1',\n    chainId: 8217,\n    nonce,\n    issuedAt: new Date(issuedAt),\n  });\n\n  return viemCreateSiweMessage({\n    domain: location.host,\n    address,\n    statement: MESSAGE_FOR_WALLET_LOGIN,\n    uri: location.origin,\n    version: '1',\n    chainId: 8217,\n    nonce,\n    issuedAt: new Date(issuedAt),\n  });\n}\n\nasync function signMessage(address: `0x${string}`): Promise<`0x${string}`> {\n  const response = await fetch(\n    `${API_BASE_URI}/nonce`,\n    {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        address,\n        domain: location.host,\n        uri: location.origin,\n      }),\n    },\n  );\n  if (!response.ok) throw new Error('nonce 생성에 실패했습니다');\n  const { nonce, issuedAt } = await response.json();\n  if (!nonce || !issuedAt) throw new Error('서버로부터 잘못된 응답을 받았습니다');\n\n  const siweMessage = createSiweMessage(address, nonce, issuedAt);\n\n  return await wagmiSignMessage(wagmiConfig, {\n    message: siweMessage,\n    account: address,\n  });\n}\n\nexport { signMessage };\n"]}